<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‚‘ç‰¹ä½©çŸ¥è­˜æ®¿å ‚ V36</title>
    <style>
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; margin: 0; padding: 0; background: #000; color: #333; user-select: none; }

        /* === ğŸ“š èƒŒæ™¯è¨­å®š (æœ¬åœ°åœ–ç‰‡) === */
        #bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('bg_knowledge.jpg'); 
            background-size: cover; background-position: center;
            filter: blur(3px) brightness(0.5);
            z-index: -1;
        }

        /* === UI ä»‹é¢ === */
        .container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; 
            padding-bottom: 100px; padding-top: 60px;
            box-sizing: border-box; position: relative; overflow-y: auto;
        }

        .header {
            position: absolute; top: 20px; width: 100%; text-align: center; color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8); z-index: 10;
        }
        .header h1 { margin: 0; font-size: 2.2rem; letter-spacing: 2px; }
        .header p { margin: 5px 0 0; color: #ddd; font-size: 0.9rem; }

        /* é¸å–® */
        #grade-menu {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center; width: 85%; max-width: 400px;
            border: 1px solid #fff; z-index: 20;
        }
        .g-btn {
            display: block; width: 100%; padding: 15px; margin: 15px 0;
            font-size: 1.3rem; font-weight: bold; border: none; border-radius: 50px;
            cursor: pointer; transition: 0.2s; color: white;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            text-align: left; padding-left: 30px; position: relative;
        }
        .g-btn:active { transform: translateY(5px); box-shadow: none; }
        .g-btn span { font-size: 0.9rem; opacity: 0.9; display: block; font-weight: normal; margin-top: 5px; }
        .btn-low { background: linear-gradient(to right, #4caf50, #81c784); }
        .btn-mid { background: linear-gradient(to right, #ff9800, #ffb74d); }
        .btn-high { background: linear-gradient(to right, #2196f3, #64b5f6); }

        /* éŠæˆ²å€ */
        #game-interface { display: none; width: 90%; max-width: 600px; animation: slideUp 0.5s; z-index: 20; }
        
        .status-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.6); color: white; padding: 10px 20px;
            border-radius: 50px; margin-bottom: 15px; font-weight: bold; font-size: 1.2rem;
            border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(5px);
        }
        
        #timer-bar-bg { width: 100%; height: 8px; background: #555; border-radius: 4px; margin-top: 5px; overflow: hidden; display: none; }
        #timer-bar-fill { height: 100%; width: 100%; background: #fb8c00; transition: width 1s linear; }
        #lives-container { color: #f44336; letter-spacing: 2px; display: none; margin-left:10px;}

        .quiz-card {
            background: #fff; border-radius: 20px; padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            text-align: center; position: relative;
            min-height: 220px; display: flex; flex-direction: column; justify-content: center;
            border: 4px solid #fff;
        }
        .subject-badge {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            background: #333; color: #fff; padding: 5px 20px; border-radius: 20px;
            font-weight: bold; font-size: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .q-text { font-size: 1.6rem; font-weight: bold; line-height: 1.4; margin: 20px 0; color: #2c3e50; }
        
        /* O/X æŒ‰éˆ• */
        .tf-area { display: flex; gap: 30px; margin-top: 30px; justify-content: center; }
        .tf-btn {
            width: 90px; height: 90px; border-radius: 50%; border: 5px solid #fff;
            font-size: 2.5rem; font-weight: bold; cursor: pointer; color: white;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: 0.1s;
        }
        .tf-btn:active { transform: scale(0.9); }
        .btn-o { background: #4caf50; } .btn-x { background: #f44336; }

        /* MCQ æŒ‰éˆ• */
        .mcq-area { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .mcq-btn {
            padding: 15px; font-size: 1.1rem; font-weight: bold; border: none;
            background: #fff; color: #333; border-radius: 12px;
            cursor: pointer; box-shadow: 0 4px 0 #ccc; border: 2px solid #eee;
            transition: 0.1s; min-height: 70px; display: flex; align-items: center; justify-content: center;
        }
        .mcq-btn:active { transform: translateY(4px); box-shadow: none; background: #eee; }

        /* çµç®— */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 100; flex-direction: column; backdrop-filter: blur(8px); }
        .modal.active { display: flex; animation: fadeIn 0.3s; } 
        .modal-box { background: #fff; padding: 30px; border-radius: 20px; width: 85%; max-width: 400px; text-align: center; border: 5px solid #eee; }
        
        .rank-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #ddd; font-size: 1rem; color:#333; text-align:left; }
        
        /* å°èˆª */
        #jetpay-navbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; height: 65px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 50px; border: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 9999; } .nav-item { text-decoration: none; color: #95a5a6; font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; transition: 0.2s; } .nav-icon { font-size: 1.6rem; margin-bottom: 2px; } .nav-item:hover { color: #2c3e50; transform: translateY(-2px); } .nav-item-special { color: #e67e22; font-weight: bold; } .nav-item-special .nav-icon { background: #e67e22; color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(230, 126, 34, 0.4); margin-top: -20px; border: 4px solid white; }

        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback-popup { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 6rem; z-index: 100; text-shadow: 0 5px 20px rgba(0,0,0,0.5); display: none; animation: popIn 0.5s; }
        @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0); } 80% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>
<body>

<div id="bg-layer"></div>

<div class="header">
    <h1>çŸ¥è­˜æ®¿å ‚</h1>
    <p>å…¨ç§‘æŒ‘æˆ°ï¼æ™ºæ…§ç„¡é™</p>
</div>

<div class="container">
    
    <div id="grade-menu">
        <h2 style="margin-top:0; color:#555;">è«‹é¸æ“‡æŒ‘æˆ°ç­‰ç´š</h2>
        <button class="g-btn btn-low" onclick="startGame('low')">
            ğŸ‘¶ ä½å¹´ç´š
            <span>ã€é€£å°ç‹ã€‘ä¸€é¡Œéƒ½ä¸èƒ½éŒ¯ï¼<br>ç§‘ç›®ï¼šç”Ÿæ´»ã€åœ‹èªã€å¸¸è­˜</span>
        </button>
        <button class="g-btn btn-mid" onclick="startGame('mid')">
            ğŸ‘¦ ä¸­å¹´ç´š
            <span>ã€é€Ÿè®€ç‹ã€‘é™æ™‚60ç§’æ¥µé€ŸæŒ‘æˆ°ï¼<br>ç§‘ç›®ï¼šç¤¾æœƒã€è‡ªç„¶ã€æˆèª</span>
        </button>
        <button class="g-btn btn-high" onclick="startGame('high')">
            ğŸ§‘â€ğŸ“ é«˜å¹´ç´š
            <span>ã€ç©åˆ†ç‹ã€‘3æ¬¡å¤±èª¤æ©Ÿæœƒï¼<br>ç§‘ç›®ï¼šæ­·å²ã€å…¬æ°‘ã€ç§‘å­¸</span>
        </button>
    </div>

    <div id="game-interface">
        
        <div class="status-bar">
            <div id="status-left"><span class="status-icon">ğŸ”°</span><span id="grade-display">ä½å¹´ç´š</span></div>
            <div id="status-right">
                <span id="score-label">åˆ†æ•¸:</span> <span id="score-val" style="color:#ffeb3b; font-size:1.4rem;">0</span>
                <span id="lives-container">â¤ï¸â¤ï¸â¤ï¸</span>
            </div>
        </div>
        <div id="timer-bar-bg"><div id="timer-bar-fill"></div></div>

        <div class="quiz-card">
            <div class="subject-badge" id="subj-badge">ç§‘ç›®</div>
            <div class="q-text" id="q-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
        </div>

        <div id="tf-panel" class="tf-area" style="display:none;">
            <div class="tf-btn btn-o" onclick="checkAns(true)">O</div>
            <div class="tf-btn btn-x" onclick="checkAns(false)">X</div>
        </div>

        <div id="mcq-panel" class="mcq-area" style="display:none;"></div>
        
        <div style="text-align:center; margin-top:20px;">
            <button onclick="location.reload()" style="padding:10px 25px; background:rgba(0,0,0,0.5); color:fff; border:1px solid rgba(255,255,255,0.5); border-radius:20px; cursor:pointer;">æ”¾æ£„æŒ‘æˆ°</button>
        </div>
    </div>

</div>

<div class="modal" id="result-modal">
    <div class="modal-box">
        <h1 id="res-title" style="margin:0 0 10px 0;">æŒ‘æˆ°çµæŸ</h1>
        <p id="res-desc" style="color:#666;"></p>
        <h2 id="res-score" style="font-size:3rem; color:#f44336; margin:10px 0;">0</h2>
        <p style="color:#999; font-size:0.9rem;">è«‹è¼¸å…¥åå­—ä¸Šå‚³æ¦®è­½æ¦œ</p>
        <input type="text" id="input-name" placeholder="ä¾‹å¦‚: 301 å°æ˜" style="padding:10px; width:80%; font-size:1.1rem; text-align:center; border:2px solid #ddd; border-radius:10px;">
        <br><br>
        <button onclick="submitScore()" style="width:100%; padding:15px; background:#2196f3; color:white; border:none; border-radius:10px; font-size:1.2rem; cursor:pointer; font-weight:bold;">ä¸Šå‚³æˆç¸¾</button>
        <button onclick="location.reload()" style="width:100%; padding:10px; background:#ddd; color:#555; border:none; border-radius:10px; margin-top:10px; cursor:pointer;">å›é¦–é </button>
    </div>
</div>

<div class="modal" id="rank-modal">
    <div class="modal-box" style="height:70vh; display:flex; flex-direction:column;">
        <h2 style="margin:0 0 15px 0;">ğŸ† è‹±é›„æ¦œ</h2>
        <div class="rank-tabs">
            <button class="g-btn btn-low" style="padding:5px; text-align:center; font-size:0.9rem;" onclick="loadRank('low')">ä½å¹´ç´š</button>
            <button class="g-btn btn-mid" style="padding:5px; text-align:center; font-size:0.9rem;" onclick="loadRank('mid')">ä¸­å¹´ç´š</button>
            <button class="g-btn btn-high" style="padding:5px; text-align:center; font-size:0.9rem;" onclick="loadRank('high')">é«˜å¹´ç´š</button>
        </div>
        <div id="rank-list" style="flex:1; overflow-y:auto; margin-top:10px; border-top:1px solid #eee;">è¼‰å…¥ä¸­...</div>
        <button onclick="document.getElementById('rank-modal').classList.remove('active')" style="margin-top:10px; padding:10px; background:#ddd; border:none; border-radius:10px; cursor:pointer;">é—œé–‰</button>
    </div>
</div>

<div id="fb-correct" class="feedback-popup">âœ…</div>
<div id="fb-wrong" class="feedback-popup">âŒ</div>

<div id="jetpay-navbar">
    <a href="index.html" class="nav-item"><span class="nav-icon">ğŸ </span><span>é¦–é </span></a>
    <a href="simple_games.html" class="nav-item"><span class="nav-icon">ğŸ§©</span><span>ç°¡å–®</span></a>
    <a href="adventure_map.html" class="nav-item"><span class="nav-icon">ğŸ°</span><span>é—–é—œ</span></a>
    <a href="knowledge_games.html" class="nav-item nav-item-special"><span class="nav-icon">ğŸ“š</span><span>çŸ¥è­˜</span></a>
    <a href="#" class="nav-item" onclick="openRank()"><span class="nav-icon">ğŸ†</span><span>æ’è¡Œ</span></a>
</div>

<script>
    // ğŸ”´ ğŸ”´ ğŸ”´ è«‹åœ¨ä¸‹æ–¹è²¼ä¸Šæ‚¨ GAS (Apps Script) çš„ç¶²å€ (V5.0) ğŸ”´ ğŸ”´ ğŸ”´
    const API_URL = "https://script.google.com/macros/s/AKfycbwKUB2BPH1jD7ch2yenKSokuHq15ktPk1UfORI0RVNYVL6_oIBISNr27MX5Yng-7i-DqA/exec";

    // === ğŸ“š V36 çœŸï¼æµ·é‡é¡Œåº« (æ¯å€‹ç­‰ç´š 50 é¡Œï¼Œå…± 150 é¡Œ) ===
    const DB = {
        low: [ // ä½å¹´ç´š: æ˜¯éé¡Œ (O/X) - 50é¡Œ
            {s:"ç”Ÿæ´»",q:"çœ‹åˆ°å¸«é•·è¦ä¸»å‹•å•å¥½ã€‚",a:true}, {s:"ç”Ÿæ´»",q:"éé¦¬è·¯è¦èµ°æ–‘é¦¬ç·šã€‚",a:true},
            {s:"ç”Ÿæ´»",q:"åƒåœ¾å¯ä»¥éš¨ä¾¿ä¸Ÿåœ¨åœ°ä¸Šã€‚",a:false}, {s:"ç”Ÿæ´»",q:"ä¸Šèª²ç™¼è¨€è¦å…ˆèˆ‰æ‰‹ã€‚",a:true},
            {s:"ç”Ÿæ´»",q:"ç¡è¦ºå‰ä¸ç”¨åˆ·ç‰™ã€‚",a:false}, {s:"ç”Ÿæ´»",q:"åƒé£¯å‰è¦æ´—æ‰‹ã€‚",a:true},
            {s:"ç”Ÿæ´»",q:"æ­å…¬è»Šè¦æ’éšŠã€‚",a:true}, {s:"ç”Ÿæ´»",q:"åœ¨åœ–æ›¸é¤¨å¯ä»¥å¤§è²å–§å˜©ã€‚",a:false},
            {s:"ç”Ÿæ´»",q:"ç´…ç‡ˆåœï¼Œç¶ ç‡ˆè¡Œã€‚",a:true}, {s:"ç”Ÿæ´»",q:"é™Œç”Ÿäººçµ¦ç³–æœå¯ä»¥åƒã€‚",a:false},
            {s:"ç”Ÿæ´»",q:"åœ°éœ‡æ™‚è¦èº²åœ¨æ¡Œå­ä¸‹ã€‚",a:true}, {s:"ç”Ÿæ´»",q:"ç”¨æ¿•æ‰‹å»æ‘¸æ’åº§ã€‚",a:false},
            {s:"åœ‹èª",q:"ã€Œå¤§ã€çš„ç›¸åè©æ˜¯ã€Œå°ã€ã€‚",a:true}, {s:"åœ‹èª",q:"ã€Œä¸Šã€çš„ç›¸åè©æ˜¯ã€Œå³ã€ã€‚",a:false},
            {s:"åœ‹èª",q:"ã€Œè˜‹æœã€æ˜¯æ°´æœã€‚",a:true}, {s:"åœ‹èª",q:"ã€Œå…¬é›ã€æœƒç”Ÿè›‹ã€‚",a:false},
            {s:"åœ‹èª",q:"ã„…ã„†ã„‡ã„ˆæ˜¯æ³¨éŸ³ç¬¦è™Ÿã€‚",a:true}, {s:"åœ‹èª",q:"ä¸€æœ¬æ›¸çš„å–®ä½æ˜¯ã€Œéš»ã€ã€‚",a:false},
            {s:"åœ‹èª",q:"å¯«å­—è¦ç”¨é‰›ç­†ã€‚",a:true}, {s:"åœ‹èª",q:"æ©¡çš®æ“¦æ˜¯ç”¨ä¾†åƒçš„ã€‚",a:false},
            {s:"åœ‹èª",q:"ã€Œå¤©ã€çš„éƒ¨é¦–æ˜¯ã€Œå¤§ã€ã€‚",a:true}, {s:"åœ‹èª",q:"ã€ŒèŠ±ã€çš„éƒ¨é¦–æ˜¯ã€Œæœ¨ã€ã€‚",a:false}, /* èŠ±æ˜¯è‰¸éƒ¨ */
            {s:"è‡ªç„¶",q:"å¤ªé™½å¾æ±é‚Šå‡èµ·ã€‚",a:true}, {s:"è‡ªç„¶",q:"æœˆäº®æ˜¯æ–¹å½¢çš„ã€‚",a:false},
            {s:"è‡ªç„¶",q:"ä¸‹é›¨å¤©æœƒæœ‰å½©è™¹ã€‚",a:true}, {s:"è‡ªç„¶",q:"é­šç”Ÿæ´»åœ¨æ°´è£¡ã€‚",a:true},
            {s:"è‡ªç„¶",q:"ç‹—æœ‰å…©éš»è…³ã€‚",a:false}, {s:"è‡ªç„¶",q:"é³¥æœƒé£›ã€‚",a:true},
            {s:"è‡ªç„¶",q:"å†°å¡ŠèåŒ–æœƒè®Šæˆæ°´ã€‚",a:true}, {s:"è‡ªç„¶",q:"å†¬å¤©æ¯”å¤å¤©ç†±ã€‚",a:false},
            {s:"è‡ªç„¶",q:"ç¨®å­ç™¼èŠ½éœ€è¦æ°´ã€‚",a:true}, {s:"è‡ªç„¶",q:"çŸ³é ­æœƒæµ®åœ¨æ°´é¢ä¸Šã€‚",a:false},
            {s:"è‹±æ–‡",q:"Apple æ˜¯è˜‹æœã€‚",a:true}, {s:"è‹±æ–‡",q:"Banana æ˜¯è‘¡è„ã€‚",a:false},
            {s:"è‹±æ–‡",q:"Cat æ˜¯è²“ã€‚",a:true}, {s:"è‹±æ–‡",q:"Dog æ˜¯è±¬ã€‚",a:false},
            {s:"è‹±æ–‡",q:"Red æ˜¯ç´…è‰²ã€‚",a:true}, {s:"è‹±æ–‡",q:"Blue æ˜¯ç¶ è‰²ã€‚",a:false},
            {s:"è‹±æ–‡",q:"One æ˜¯æ•¸å­— 1ã€‚",a:true}, {s:"è‹±æ–‡",q:"Yes çš„æ„æ€æ˜¯ã€Œä¸ã€ã€‚",a:false},
            {s:"æ•¸å­¸",q:"5 + 5 = 10",a:true}, {s:"æ•¸å­¸",q:"10 - 2 = 5",a:false},
            {s:"æ•¸å­¸",q:"ä¸‰è§’å½¢æœ‰ 3 å€‹è§’ã€‚",a:true}, {s:"æ•¸å­¸",q:"æ­£æ–¹å½¢æœ‰ 5 å€‹é‚Šã€‚",a:false},
            {s:"æ•¸å­¸",q:"10 å…ƒæ¯” 5 å…ƒå¤šã€‚",a:true}, {s:"æ•¸å­¸",q:"1 å°æ™‚æœ‰ 100 åˆ†é˜ã€‚",a:false},
            {s:"æ•¸å­¸",q:"æ™‚é˜é•·é‡æ˜¯åˆ†é‡ã€‚",a:true}, {s:"æ•¸å­¸",q:"7 + 3 = 9",a:false},
            {s:"æ•¸å­¸",q:"2 å€‹ 5 æ˜¯ 10ã€‚",a:true}, {s:"æ•¸å­¸",q:"åœ“å½¢æœ‰ 4 å€‹è§’ã€‚",a:false}
        ],
        mid: [ // ä¸­å¹´ç´š: å››é¸ä¸€ - 50é¡Œ
            {s:"ç¤¾æœƒ",q:"å°ç£çš„é¦–éƒ½åœ¨å“ªè£¡ï¼Ÿ",o:["å°åŒ—","é«˜é›„","å°ä¸­","å°å—"],a:"å°åŒ—"},
            {s:"ç¤¾æœƒ",q:"æˆ‘å€‘å±…ä½çš„å³¶å¶¼æ˜¯ï¼Ÿ",o:["å°ç£","æµ·å—å³¶","æ¾æ¹–","é‡‘é–€"],a:"å°ç£"},
            {s:"ç¤¾æœƒ",q:"å°ç£æœ€é«˜çš„å±±æ˜¯ï¼Ÿ",o:["ç‰å±±","é˜¿é‡Œå±±","é™½æ˜å±±","é›ªå±±"],a:"ç‰å±±"},
            {s:"ç¤¾æœƒ",q:"ç«¯åˆç¯€è¦åƒä»€éº¼ï¼Ÿ",o:["ç²½å­","æœˆé¤…","æ¹¯åœ“","è›‹ç³•"],a:"ç²½å­"},
            {s:"ç¤¾æœƒ",q:"ä¸­ç§‹ç¯€çš„å‚³èªªäººç‰©ï¼Ÿ",o:["å«¦å¨¥","å±ˆåŸ","å¹´ç¸","åª½ç¥–"],a:"å«¦å¨¥"},
            {s:"ç¤¾æœƒ",q:"éƒµå·®çš„å·¥ä½œæ˜¯ï¼Ÿ",o:["é€ä¿¡","æŠ“å°å·","æ•‘ç«","ç…®é£¯"],a:"é€ä¿¡"},
            {s:"ç¤¾æœƒ",q:"ä¸‹åˆ—å“ªå€‹æ˜¯ç›´è½„å¸‚ï¼Ÿ",o:["æ¡ƒåœ’å¸‚","åŸºéš†å¸‚","æ–°ç«¹å¸‚","å˜‰ç¾©å¸‚"],a:"æ¡ƒåœ’å¸‚"},
            {s:"ç¤¾æœƒ",q:"è­¦å¯Ÿå±€çš„é›»è©±æ˜¯ï¼Ÿ",o:["110","119","165","104"],a:"110"},
            {s:"ç¤¾æœƒ",q:"ç«ç½è¦æ‰“å¹¾è™Ÿï¼Ÿ",o:["119","110","113","1999"],a:"119"},
            {s:"ç¤¾æœƒ",q:"å°ç£å››å‘¨ç’°ç¹è‘—ï¼Ÿ",o:["æµ·æ´‹","æ²™æ¼ ","é«˜å±±","æ£®æ—"],a:"æµ·æ´‹"},
            {s:"è‡ªç„¶",q:"ç£éµèƒ½å¸ä»€éº¼ï¼Ÿ",o:["éµé‡˜","æœ¨é ­","å¡‘è† ","ç´™"],a:"éµé‡˜"},
            {s:"è‡ªç„¶",q:"é’è›™çš„å°æ™‚å€™å«ï¼Ÿ",o:["èŒèšª","æ¯›æ¯›èŸ²","å°é­š","å­‘å­“"],a:"èŒèšª"},
            {s:"è‡ªç„¶",q:"æ¤ç‰©è¡Œå…‰åˆä½œç”¨éœ€è¦ï¼Ÿ",o:["é™½å…‰","æœˆå…‰","æ˜Ÿå…‰","ç‡ˆå…‰"],a:"é™½å…‰"},
            {s:"è‡ªç„¶",q:"æ°´çµå†°æœƒè®Šæˆï¼Ÿ",o:["å›ºé«”","æ°£é«”","æ¶²é«”","è»Ÿé«”"],a:"å›ºé«”"},
            {s:"è‡ªç„¶",q:"æ˜†èŸ²æœ‰å¹¾éš»è…³ï¼Ÿ",o:["6éš»","4éš»","8éš»","10éš»"],a:"6éš»"},
            {s:"è‡ªç„¶",q:"æœƒå°é›»çš„ç‰©é«”ï¼Ÿ",o:["éŠ…ç·š","å¡‘è† å°º","æ©¡çš®æ“¦","æœ¨æ£’"],a:"éŠ…ç·š"},
            {s:"è‡ªç„¶",q:"æŒ‡åŒ—é‡Næ¥µæŒ‡å‘ï¼Ÿ",o:["åŒ—æ–¹","å—æ–¹","æ±æ–¹","è¥¿æ–¹"],a:"åŒ—æ–¹"},
            {s:"è‡ªç„¶",q:"å½©è™¹æœ‰å¹¾ç¨®é¡è‰²ï¼Ÿ",o:["7ç¨®","5ç¨®","3ç¨®","10ç¨®"],a:"7ç¨®"},
            {s:"è‡ªç„¶",q:"è´è¶æ˜¯å®Œå…¨è®Šæ…‹æ˜†èŸ²å—ï¼Ÿ",o:["æ˜¯","ä¸æ˜¯","ä¸ä¸€å®š","çœ‹å¿ƒæƒ…"],a:"æ˜¯"},
            {s:"è‡ªç„¶",q:"æœˆäº®ç¹è‘—èª°è½‰ï¼Ÿ",o:["åœ°çƒ","å¤ªé™½","ç«æ˜Ÿ","é‡‘æ˜Ÿ"],a:"åœ°çƒ"},
            {s:"åœ‹èª",q:"ã€Œä¸€__é©šäººã€ï¼Ÿ",o:["é³´","å","æ°‘","æ˜"],a:"é³´"},
            {s:"åœ‹èª",q:"ã€Œå®ˆæ ªå¾…__ã€ï¼Ÿ",o:["å…”","è™","è±¬","é¾"],a:"å…”"},
            {s:"åœ‹èª",q:"ã€Œç•«è›‡æ·»__ã€ï¼Ÿ",o:["è¶³","è…³","æ‰‹","å°¾"],a:"è¶³"},
            {s:"åœ‹èª",q:"ã€Œå¿å¿‘ã€çš„æ„æ€ï¼Ÿ",o:["å¿ƒæƒ…ä¸å®‰","éå¸¸é–‹å¿ƒ","ç”Ÿæ°£","è‚šå­é¤“"],a:"å¿ƒæƒ…ä¸å®‰"},
            {s:"åœ‹èª",q:"å“ªä¸€å€‹å­—æœ‰éŒ¯ï¼Ÿ",o:["å†æ¥å†å‹µ","å†æ¥å†å²","é¥è€Œä¸æ¨","å …æŒåˆ°åº•"],a:"å†æ¥å†å‹µ"},
            {s:"åœ‹èª",q:"å½¢å®¹è®€æ›¸å¾ˆå°ˆå¿ƒï¼Ÿ",o:["èšç²¾æœƒç¥","ä¸‰å¿ƒäºŒæ„","æ±å¼µè¥¿æœ›","é¦¬é¦¬è™è™"],a:"èšç²¾æœƒç¥"},
            {s:"åœ‹èª",q:"ã€Œå°å¿ƒç¿¼ç¿¼ã€çš„æ„æ€ï¼Ÿ",o:["éå¸¸è¬¹æ…","éå¸¸å¤§è†½","éå¸¸å¿«é€Ÿ","éå¸¸é–‹å¿ƒ"],a:"éå¸¸è¬¹æ…"},
            {s:"åœ‹èª",q:"ã€Œåœ–æ›¸é¤¨ã€çš„é‡è©ï¼Ÿ",o:["åº§","éš»","æ¢","å¼µ"],a:"åº§"},
            {s:"åœ‹èª",q:"æ›¸ä¿¡ä¸­ç¨±å‘¼è€å¸«ï¼Ÿ",o:["å¤«å­","é–£ä¸‹","å¾æ„›","è†ä¸‹"],a:"å¤«å­"},
            {s:"åœ‹èª",q:"å­—å…¸æ˜¯ç”¨ä»€éº¼æ’åˆ—ï¼Ÿ",o:["éƒ¨é¦–","å¿ƒæƒ…","é¡è‰²","å¤§å°"],a:"éƒ¨é¦–"},
            {s:"è‹±æ–‡",q:"Thank you çš„æ„æ€ï¼Ÿ",o:["è¬è¬","å°ä¸èµ·","ä½ å¥½","å†è¦‹"],a:"è¬è¬"},
            {s:"è‹±æ–‡",q:"Library æ˜¯ä»€éº¼ï¼Ÿ",o:["åœ–æ›¸é¤¨","å­¸æ ¡","å…¬åœ’","é†«é™¢"],a:"åœ–æ›¸é¤¨"},
            {s:"è‹±æ–‡",q:"Monday æ˜¯æ˜ŸæœŸå¹¾ï¼Ÿ",o:["æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸæ—¥"],a:"æ˜ŸæœŸä¸€"},
            {s:"è‹±æ–‡",q:"Eleven æ˜¯æ•¸å­—ï¼Ÿ",o:["11","12","7","10"],a:"11"},
            {s:"è‹±æ–‡",q:"Teacher æ˜¯èª°ï¼Ÿ",o:["è€å¸«","å­¸ç”Ÿ","é†«ç”Ÿ","è­¦å¯Ÿ"],a:"è€å¸«"},
            {s:"è‹±æ–‡",q:"Book æ˜¯ä»€éº¼ï¼Ÿ",o:["æ›¸","ç­†","å°º","æ©¡çš®æ“¦"],a:"æ›¸"},
            {s:"è‹±æ–‡",q:"Happy æ˜¯ä»€éº¼æ„Ÿè¦ºï¼Ÿ",o:["å¿«æ¨‚","ç”Ÿæ°£","é›£é","å®³æ€•"],a:"å¿«æ¨‚"},
            {s:"è‹±æ–‡",q:"Tiger æ˜¯ä»€éº¼å‹•ç‰©ï¼Ÿ",o:["è€è™","ç…å­","è²“","ç‹—"],a:"è€è™"},
            {s:"è‹±æ–‡",q:"Yellow æ˜¯ä»€éº¼è‰²ï¼Ÿ",o:["é»ƒè‰²","ç´…è‰²","è—è‰²","ç¶ è‰²"],a:"é»ƒè‰²"},
            {s:"è‹±æ–‡",q:"Good morning æ˜¯ï¼Ÿ",o:["æ—©å®‰","æ™šå®‰","åˆå®‰","å†è¦‹"],a:"æ—©å®‰"},
            {s:"æ•¸å­¸",q:"8 x 7 = ?",o:["56","48","64","54"],a:"56"},
            {s:"æ•¸å­¸",q:"45 Ã· 5 = ?",o:["9","8","7","6"],a:"9"},
            {s:"æ•¸å­¸",q:"1å…¬é‡Œ = ? å…¬å°º",o:["1000","100","10","10000"],a:"1000"},
            {s:"æ•¸å­¸",q:"ç›´è§’æ˜¯å¹¾åº¦ï¼Ÿ",o:["90åº¦","60åº¦","45åº¦","180åº¦"],a:"90åº¦"},
            {s:"æ•¸å­¸",q:"æ­£æ–¹å½¢å‘¨é•·å…¬å¼ï¼Ÿ",o:["é‚Šé•·x4","é‚Šé•·x2","é‚Šé•·xé‚Šé•·","é‚Šé•·+4"],a:"é‚Šé•·x4"},
            {s:"æ•¸å­¸",q:"1å¤©æœ‰å¹¾å°æ™‚ï¼Ÿ",o:["24","12","60","365"],a:"24"},
            {s:"æ•¸å­¸",q:"1å…¬æ–¤ = ? å…¬å…‹",o:["1000","100","10","500"],a:"1000"},
            {s:"æ•¸å­¸",q:"é˜é¢ä¸€åœˆå¹¾åˆ†é˜ï¼Ÿ",o:["60","30","12","24"],a:"60"},
            {s:"æ•¸å­¸",q:"å¶æ•¸æ˜¯ï¼Ÿ",o:["2,4,6","1,3,5","1,2,3","0,5,10"],a:"2,4,6"},
            {s:"æ•¸å­¸",q:"ä¸‰è§’å½¢å…§è§’å’Œï¼Ÿ",o:["180åº¦","360åº¦","90åº¦","100åº¦"],a:"180åº¦"}
        ],
        high: [ // é«˜å¹´ç´š: å››é¸ä¸€ (é€²éš) - 50é¡Œ
            {s:"ç¤¾æœƒ",q:"é„­æˆåŠŸè¶•èµ°èª°ï¼Ÿ",o:["è·è˜­äºº","è¥¿ç­ç‰™äºº","æ—¥æœ¬äºº","æ³•åœ‹äºº"],a:"è·è˜­äºº"},
            {s:"ç¤¾æœƒ",q:"å°ç£æœ€é•·çš„æ²³æµï¼Ÿ",o:["æ¿æ°´æºª","é«˜å±æºª","æ·¡æ°´æ²³","å¤§ç”²æºª"],a:"æ¿æ°´æºª"},
            {s:"ç¤¾æœƒ",q:"ç«‹æ³•é™¢è² è²¬ä»€éº¼ï¼Ÿ",o:["åˆ¶å®šæ³•å¾‹","å¯©åˆ¤","è¡Œæ”¿","è€ƒè©¦"],a:"åˆ¶å®šæ³•å¾‹"},
            {s:"ç¤¾æœƒ",q:"ä¸­è¯æ°‘åœ‹åœ‹çˆ¶ï¼Ÿ",o:["å­«ä¸­å±±","è”£ä¸­æ­£","æ—è‚¯","å­”å­"],a:"å­«ä¸­å±±"},
            {s:"ç¤¾æœƒ",q:"å°ç£åœ°å½¢ç‰¹è‰²ï¼Ÿ",o:["å±±å¤šå¹³åŸå°‘","å¹³åŸå¤šå±±å°‘","å…¨æ˜¯æ²™æ¼ ","å…¨æ˜¯å†°åŸ"],a:"å±±å¤šå¹³åŸå°‘"},
            {s:"ç¤¾æœƒ",q:"è¡Œæ”¿é™¢é•·æ˜¯èª°ä»»å‘½ï¼Ÿ",o:["ç¸½çµ±","äººæ°‘","ç«‹æ³•é™¢","ç›£å¯Ÿé™¢"],a:"ç¸½çµ±"},
            {s:"ç¤¾æœƒ",q:"å°ç£å…‰å¾©ç¯€æ˜¯ï¼Ÿ",o:["10/25","10/10","1/1","2/28"],a:"10/25"},
            {s:"ç¤¾æœƒ",q:"å¤è¹Ÿåˆ†ç´šä¸»ç®¡æ©Ÿé—œï¼Ÿ",o:["æ–‡åŒ–éƒ¨","æ•™è‚²éƒ¨","å…§æ”¿éƒ¨","äº¤é€šéƒ¨"],a:"æ–‡åŒ–éƒ¨"},
            {s:"ç¤¾æœƒ",q:"å…¨çƒæš–åŒ–ä¸»å› ï¼Ÿ",o:["æº«å®¤æ°£é«”","è‡­æ°§å±¤","ç«å±±çˆ†ç™¼","å¤ªé™½é»‘å­"],a:"æº«å®¤æ°£é«”"},
            {s:"ç¤¾æœƒ",q:"å°ç£æœ€å¤§å¹³åŸï¼Ÿ",o:["å˜‰å—å¹³åŸ","å±æ±å¹³åŸ","å®œè˜­å¹³åŸ","èŠ±æ±ç¸±è°·"],a:"å˜‰å—å¹³åŸ"},
            {s:"è‡ªç„¶",q:"æ¤ç‰©è£½é€ é¤Šåˆ†ï¼Ÿ",o:["å…‰åˆä½œç”¨","å‘¼å¸ä½œç”¨","è’¸æ•£ä½œç”¨","æ¶ˆåŒ–ä½œç”¨"],a:"å…‰åˆä½œç”¨"},
            {s:"è‡ªç„¶",q:"å°é›»æ€§æœ€å¥½é‡‘å±¬ï¼Ÿ",o:["éŠ€","éŠ…","é‡‘","éµ"],a:"éŠ€"},
            {s:"è‡ªç„¶",q:"å¤§æ°£ä¸­æœ€å¤šçš„æ°£é«”ï¼Ÿ",o:["æ°®æ°£","æ°§æ°£","äºŒæ°§åŒ–ç¢³","æ°«æ°£"],a:"æ°®æ°£"},
            {s:"è‡ªç„¶",q:"æ§“æ¡¿åŸç†æ”¯é»åœ¨ä¸­é–“ï¼Ÿ",o:["è¹ºè¹ºæ¿","é–‹ç“¶å™¨","éºµåŒ…å¤¾","é‡£é­šç«¿"],a:"è¹ºè¹ºæ¿"},
            {s:"è‡ªç„¶",q:"å¤ªé™½ç³»æœ€å¤§è¡Œæ˜Ÿï¼Ÿ",o:["æœ¨æ˜Ÿ","åœŸæ˜Ÿ","åœ°çƒ","ç«æ˜Ÿ"],a:"æœ¨æ˜Ÿ"},
            {s:"è‡ªç„¶",q:"äººé«”æœ€å¤§å™¨å®˜ï¼Ÿ",o:["çš®è†š","è‚è‡Ÿ","å¤§è…¦","å¿ƒè‡Ÿ"],a:"çš®è†š"},
            {s:"è‡ªç„¶",q:"æ°´çš„ä¸‰æ…‹ä¸åŒ…å«ï¼Ÿ",o:["é›»æ¼¿","å›ºé«”","æ¶²é«”","æ°£é«”"],a:"é›»æ¼¿"},
            {s:"è‡ªç„¶",q:"é…¸é›¨çš„pHå€¼ï¼Ÿ",o:["å°æ–¼5.0","ç­‰æ–¼7.0","å¤§æ–¼7.0","ç­‰æ–¼10"],a:"å°æ–¼5.0"},
            {s:"è‡ªç„¶",q:"åŒ—æ¥µæ˜Ÿåœ¨å“ªå€‹æ˜Ÿåº§ï¼Ÿ",o:["å°ç†Šåº§","å¤§ç†Šåº§","çµæˆ¶åº§","ä»™ååº§"],a:"å°ç†Šåº§"},
            {s:"è‡ªç„¶",q:"æ¤ç‰©æ ¹çš„ä¸»è¦åŠŸèƒ½ï¼Ÿ",o:["å¸æ”¶æ°´åˆ†","è£½é€ é¤Šåˆ†","å‚³æ’­èŠ±ç²‰","è¡Œå…‰åˆä½œç”¨"],a:"å¸æ”¶æ°´åˆ†"},
            {s:"åœ‹èª",q:"å“ªå€‹æ˜¯èª‡é£¾ä¿®è¾­ï¼Ÿ",o:["ç™½é«®ä¸‰åƒä¸ˆ","èŠ±å…’å°æˆ‘ç¬‘","å¤©æ°£å¾ˆç†±","ä»–è·‘å¾ˆå¿«"],a:"ç™½é«®ä¸‰åƒä¸ˆ"},
            {s:"åœ‹èª",q:"ã€Œè†¾ã€ç‚™äººå£è®€éŸ³ï¼Ÿ",o:["ã„ã„¨ã„Ë‹","ã„ã„¨ã„ŸË‹","ã„ã„¨ã„ŸË‹","ã„ã„¨ã„ŸË‹"],a:"ã„ã„¨ã„Ë‹"},
            {s:"åœ‹èª",q:"å“ªå€‹ä¸æ˜¯æˆèªï¼Ÿ",o:["åƒé£¯ç¡è¦º","ä¸ƒä¸Šå…«ä¸‹","ä¸€å¿ƒä¸€æ„","äº”èŠ±å…«é–€"],a:"åƒé£¯ç¡è¦º"},
            {s:"åœ‹èª",q:"ã€ŒèºŠèº‡ã€çš„æ„æ€ï¼Ÿ",o:["çŒ¶è±«ä¸æ±º","éå¸¸æœæ–·","èµ°è·¯å¾ˆå¿«","éå¸¸ç”Ÿæ°£"],a:"çŒ¶è±«ä¸æ±º"},
            {s:"åœ‹èª",q:"è©©ä»™æ˜¯æŒ‡èª°ï¼Ÿ",o:["æç™½","æœç”«","ç™½å±…æ˜“","ç‹ç¶­"],a:"æç™½"},
            {s:"åœ‹èª",q:"ã€Œæ›‡èŠ±ä¸€ç¾ã€æ¯”å–»ï¼Ÿ",o:["äº‹ç‰©çŸ­æš«","èŠ±é–‹å¾—å¾ˆç¾","æ™‚é–“å¾ˆé•·","éå¸¸çè²´"],a:"äº‹ç‰©çŸ­æš«"},
            {s:"åœ‹èª",q:"ä¸‹åˆ—ä½•è€…ç‚ºæ“¬äººï¼Ÿ",o:["é¢¨åœ¨å”±æ­Œ","é›¨åƒçœ¼æ·š","åƒè±¬ä¸€æ¨£","å¤§å¦‚ç‰›"],a:"é¢¨åœ¨å”±æ­Œ"},
            {s:"åœ‹èª",q:"æ›¸ä¿¡çµå°¾çµ¦å¹³è¼©ï¼Ÿ",o:["å°å•Ÿ","éˆå•Ÿ","å®‰å•Ÿ","ç¦å•Ÿ"],a:"å°å•Ÿ"},
            {s:"åœ‹èª",q:"ã€Œå­‘å­“ã€æ˜¯ä»€éº¼ï¼Ÿ",o:["èšŠå­å¹¼èŸ²","è’¼è …å¹¼èŸ²","èŸ‘è‚å¹¼èŸ²","èèŸ»å¹¼èŸ²"],a:"èšŠå­å¹¼èŸ²"},
            {s:"åœ‹èª",q:"å››å¤§å¥‡æ›¸ä¸åŒ…å«ï¼Ÿ",o:["èŠé½‹èªŒç•°","è¥¿éŠè¨˜","æ°´æ»¸å‚³","ä¸‰åœ‹æ¼”ç¾©"],a:"èŠé½‹èªŒç•°"},
            {s:"è‹±æ–‡",q:"Delicious æ„æ€ï¼Ÿ",o:["ç¾å‘³çš„","å±éšªçš„","ç”Ÿæ°£çš„","å¿«æ¨‚çš„"],a:"ç¾å‘³çš„"},
            {s:"è‹±æ–‡",q:"Hospital æ„æ€ï¼Ÿ",o:["é†«é™¢","å­¸æ ¡","é£¯åº—","éŠ€è¡Œ"],a:"é†«é™¢"},
            {s:"è‹±æ–‡",q:"Yesterday æ„æ€ï¼Ÿ",o:["æ˜¨å¤©","ä»Šå¤©","æ˜å¤©","å¾Œå¤©"],a:"æ˜¨å¤©"},
            {s:"è‹±æ–‡",q:"Elephant æ„æ€ï¼Ÿ",o:["å¤§è±¡","ç…å­","è€è™","çŒ´å­"],a:"å¤§è±¡"},
            {s:"è‹±æ–‡",q:"Beautiful ç›¸åè©ï¼Ÿ",o:["Ugly","Good","Nice","Pretty"],a:"Ugly"},
            {s:"è‹±æ–‡",q:"Summer æ˜¯ä»€éº¼ï¼Ÿ",o:["å¤å¤©","å†¬å¤©","æ˜¥å¤©","ç§‹å¤©"],a:"å¤å¤©"},
            {s:"è‹±æ–‡",q:"Breakfast æ˜¯ï¼Ÿ",o:["æ—©é¤","åˆé¤","æ™šé¤","é»å¿ƒ"],a:"æ—©é¤"},
            {s:"è‹±æ–‡",q:"Doctor æ˜¯ï¼Ÿ",o:["é†«ç”Ÿ","è­·å£«","ç—…äºº","è€å¸«"],a:"é†«ç”Ÿ"},
            {s:"è‹±æ–‡",q:"Bathroom æ˜¯ï¼Ÿ",o:["æµ´å®¤","è‡¥å®¤","å»šæˆ¿","å®¢å»³"],a:"æµ´å®¤"},
            {s:"è‹±æ–‡",q:"Twelve æ˜¯ï¼Ÿ",o:["12","20","11","21"],a:"12"},
            {s:"æ•¸å­¸",q:"0.5 + 0.5 = ?",o:["1","0.55","0.1","10"],a:"1"},
            {s:"æ•¸å­¸",q:"åœ“å‘¨ç‡ç´„ç­‰æ–¼ï¼Ÿ",o:["3.14","3.41","3.12","3.00"],a:"3.14"},
            {s:"æ•¸å­¸",q:"1å…¬å™¸ = ? å…¬æ–¤",o:["1000","100","10","10000"],a:"1000"},
            {s:"æ•¸å­¸",q:"25 x 4 + 10 = ?",o:["110","100","90","120"],a:"110"},
            {s:"æ•¸å­¸",q:"é•·æ–¹å½¢é¢ç©å…¬å¼ï¼Ÿ",o:["é•·xå¯¬","é‚Šé•·xé‚Šé•·","åº•xé«˜/2","(ä¸Šåº•+ä¸‹åº•)xé«˜/2"],a:"é•·xå¯¬"},
            {s:"æ•¸å­¸",q:"ä¸‰è§’å½¢é¢ç©å…¬å¼ï¼Ÿ",o:["åº•xé«˜Ã·2","åº•xé«˜","é‚Šé•·xé‚Šé•·","é•·xå¯¬"],a:"åº•xé«˜Ã·2"},
            {s:"æ•¸å­¸",q:"1/2 + 1/2 = ?",o:["1","1/4","2/4","2"],a:"1"},
            {s:"æ•¸å­¸",q:"æ­£æ–¹é«”æœ‰å¹¾å€‹é¢ï¼Ÿ",o:["6å€‹","4å€‹","8å€‹","12å€‹"],a:"6å€‹"},
            {s:"æ•¸å­¸",q:"1å…¬å‡ = ? æ¯«å‡",o:["1000","100","10","500"],a:"1000"},
            {s:"æ•¸å­¸",q:"å“ªå€‹åˆ†æ•¸æœ€å¤§ï¼Ÿ",o:["1/2","1/3","1/4","1/5"],a:"1/2"}
        ]
    };

    let state = { grade: '', score: 0, lives: 3, timer: 60, timerId: null, isOver: false, usedQ: [] };
    let currentQuestion = null;
    let usedQuestions = { low: [], mid: [], high: [] }; 

    function startGame(grade) {
        state.grade = grade;
        state.score = 0;
        state.isOver = false;
        
        // åˆ‡æ›ä»‹é¢
        document.getElementById('grade-menu').style.display = 'none';
        document.getElementById('game-interface').style.display = 'block';
        document.getElementById('score-val').innerText = 0;
        
        // æ¨¡å¼è¨­å®š
        if (grade === 'low') {
            document.getElementById('grade-display').innerText = "ä½å¹´ç´šï¼é€£å°æŒ‘æˆ°";
            document.getElementById('score-label').innerText = "é€£å°:";
            document.getElementById('tf-panel').style.display = 'flex';
            document.getElementById('mcq-panel').style.display = 'none';
            document.getElementById('lives-container').style.display = 'none';
            document.getElementById('timer-bar-bg').style.display = 'none';
        } else if (grade === 'mid') {
            document.getElementById('grade-display').innerText = "ä¸­å¹´ç´šï¼é™æ™‚æŒ‘æˆ°";
            document.getElementById('score-label').innerText = "å¾—åˆ†:";
            document.getElementById('tf-panel').style.display = 'none';
            document.getElementById('mcq-panel').style.display = 'grid';
            document.getElementById('lives-container').style.display = 'none';
            document.getElementById('timer-bar-bg').style.display = 'block';
            startTimer();
        } else {
            document.getElementById('grade-display').innerText = "é«˜å¹´ç´šï¼ç©åˆ†æŒ‘æˆ°";
            document.getElementById('score-label').innerText = "å¾—åˆ†:";
            state.lives = 3;
            updateLives();
            document.getElementById('tf-panel').style.display = 'none';
            document.getElementById('mcq-panel').style.display = 'grid';
            document.getElementById('lives-container').style.display = 'inline';
            document.getElementById('timer-bar-bg').style.display = 'none';
        }

        nextQuestion();
    }

    function startTimer() {
        state.timer = 60;
        if(state.timerId) clearInterval(state.timerId);
        state.timerId = setInterval(() => {
            state.timer--;
            let pct = (state.timer / 60) * 100;
            document.getElementById('timer-bar-fill').style.width = pct + "%";
            if(state.timer <= 0) gameOver("æ™‚é–“åˆ°ï¼");
        }, 1000);
    }

    function updateLives() {
        let h = "";
        for(let i=0; i<state.lives; i++) h += "â¤ï¸";
        document.getElementById('lives-container').innerText = h;
    }

    function nextQuestion() {
        if(state.isOver) return;
        
        const pool = DB[state.grade];
        const used = usedQuestions[state.grade];

        if (used.length >= pool.length) {
            alert("ğŸ‰ å¤ªå²å®³äº†ï¼ä½ å·²ç¶“å®Œæˆäº†é€™å€‹ç­‰ç´šçš„æ‰€æœ‰é¡Œç›®ï¼\nå³å°‡é‡ç½®é¡Œç›®...");
            usedQuestions[state.grade] = []; 
        }

        let randIdx;
        do {
            randIdx = Math.floor(Math.random() * pool.length);
        } while (used.includes(randIdx));

        usedQuestions[state.grade].push(randIdx);
        currentQuestion = pool[randIdx];
        
        document.getElementById('subj-badge').innerText = currentQuestion.s;
        document.getElementById('q-text').innerText = currentQuestion.q;

        if (state.grade !== 'low') {
            const panel = document.getElementById('mcq-panel');
            panel.innerHTML = '';
            let opts = [...currentQuestion.o];
            opts.sort(() => Math.random() - 0.5);
            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'mcq-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAns(opt);
                panel.appendChild(btn);
            });
        }
    }

    function checkAns(ans) {
        if(state.isOver) return;
        let isCorrect = (ans === currentQuestion.a);
        
        showFeedback(isCorrect);

        if (isCorrect) {
            if(state.grade === 'low') state.score++; 
            else state.score += 10; 
            
            document.getElementById('score-val').innerText = state.score;
            setTimeout(nextQuestion, 600);
        } else {
            if (state.grade === 'low') {
                gameOver("ç­”éŒ¯äº†ï¼æŒ‘æˆ°çµæŸ");
            } else if (state.grade === 'mid') {
                setTimeout(nextQuestion, 600);
            } else {
                state.lives--;
                updateLives();
                if(state.lives <= 0) gameOver("ç”Ÿå‘½è€—ç›¡ï¼");
                else setTimeout(nextQuestion, 600);
            }
        }
    }

    function showFeedback(isCorrect) {
        const id = isCorrect ? 'fb-correct' : 'fb-wrong';
        const el = document.getElementById(id);
        el.style.display = 'block';
        el.style.animation = 'none';
        el.offsetHeight; 
        el.style.animation = 'popIn 0.5s';
        setTimeout(() => { el.style.display = 'none'; }, 600);
    }

    function gameOver(msg) {
        state.isOver = true;
        if(state.timerId) clearInterval(state.timerId);
        
        document.getElementById('result-modal').classList.add('active');
        document.getElementById('res-title').innerText = msg;
        
        let desc = "";
        if(state.grade === 'low') desc = `ä½ çš„é€£å°ç´€éŒ„ï¼š`;
        else desc = `æœ€çµ‚å¾—åˆ†ï¼š`;
        
        document.getElementById('res-desc').innerText = desc;
        document.getElementById('res-score').innerText = state.score;
    }

    function submitScore() {
        const n = document.getElementById('input-name').value.trim();
        if(!n) { alert("è«‹è¼¸å…¥åå­—"); return; }
        
        fetch(API_URL, { 
            method:'POST', 
            body:JSON.stringify({type:'record', name:n, time:state.score, grade:state.grade}), 
            headers:{"Content-Type":"text/plain"} 
        })
        .then(r=>r.json()).then(d=>{ alert("âœ… ä¸Šå‚³æˆåŠŸ"); location.reload(); })
        .catch(e=>{ alert("ä¸Šå‚³å¤±æ•—"); });
    }

    function openRank() { document.getElementById('rank-modal').classList.add('active'); loadRank(state.grade || 'low'); }
    
    function loadRank(grade) {
        document.getElementById('rank-list').innerHTML = "è¼‰å…¥ä¸­...";
        fetch(API_URL + `?action=getRank&grade=${grade}&sort=desc`)
            .then(r=>r.json())
            .then(d=>{
                const div = document.getElementById('rank-list');
                div.innerHTML = "";
                if(d.length==0) div.innerHTML = '<div style="text-align:center; padding:20px;">å°šç„¡ç´€éŒ„</div>';
                d.slice(0,10).forEach((row,i) => {
                    let medal = i===0?'ğŸ¥‡':(i===1?'ğŸ¥ˆ':(i===2?'ğŸ¥‰':(i+1+'.')));
                    let unit = (grade === 'low') ? "é¡Œ" : "åˆ†";
                    div.innerHTML += `<div class="rank-row"><span>${medal} ${row.name}</span><span>${row.score}${unit}</span></div>`;
                });
            });
    }
</script>
</body>
</html>