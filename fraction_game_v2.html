<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ«è–©åˆ‡åˆ‡æ¨‚ V2ï¼šåˆ†æ•¸åŠ æ¸›å¤§æŒ‘æˆ°</title>
    <style>
        /* --- æ¨£å¼è¨­å®šé–‹å§‹ --- */
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background-color: #f4f7f6; text-align: center; padding: 20px; }
        .container { max-width: 850px; margin: 0 auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        h1 { color: #FF5722; margin-bottom: 10px; font-size: 2.2rem; }
        .score-board { font-size: 1.2rem; color: #666; margin-bottom: 30px; background: #eee; display: inline-block; padding: 10px 20px; border-radius: 50px;}
        .game-area { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 30px 0; flex-wrap: wrap; }
        .fraction-box { display: flex; flex-direction: column; align-items: center; position: relative; }
        
        /* è¦–è¦ºåŒ–å€åŸŸå®¹å™¨ */
        .visual-container {
            width: 140px; height: 140px; position: relative; margin-bottom: 10px;
        }
        /* æŠ«è–©åº•åœ–èˆ‡é¡è‰²å¡«å…… (CSS Conic Gradient) */
        .pie-fill { 
            width: 100%; height: 100%; border-radius: 50%; 
            border: 4px solid #333; box-sizing: border-box;
            position: absolute; top: 0; left: 0;
            /* é è¨­èƒŒæ™¯ */
            background: conic-gradient(#ddd 0% 100%);
            transition: background 0.5s ease;
        }
        /* SVG åˆ‡ç·šåœ–å±¤ (ç–ŠåŠ åœ¨å¡«å……å±¤ä¸Šæ–¹) */
        .slice-outlines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* è®“æ»‘é¼ äº‹ä»¶ç©¿é€ */
        }
        /* åˆ‡ç·šçš„æ¨£å¼ï¼šæ·±ç°è‰²è™›ç·š */
        .slice-line {
            stroke: #444;
            stroke-width: 2;
            stroke-dasharray: 4 2; /* è™›ç·šæ•ˆæœ */
            opacity: 0.7;
        }

        .operator { font-size: 3rem; font-weight: bold; color: #333; margin: 0 10px; }
        /* åˆ†æ•¸æ–‡å­—é¡¯ç¤ºå„ªåŒ– */
        .fraction-text { font-size: 2rem; font-weight: bold; color: #2c3e50; line-height: 1; }
        .fraction-text sup { font-size: 0.6em; vertical-align: 0.3em; }
        .fraction-text sub { font-size: 0.6em; vertical-align: -0.2em; }
        
        .answer-section { margin-top: 40px; padding: 25px; background: #FFF9C4; border-radius: 20px; }
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .input-group { display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; }
        input[type=number] { width: 70px; height: 60px; font-size: 2rem; text-align: center; border: 3px solid #FF9800; border-radius: 12px; background: #fff; color: #333; font-weight: bold; }
        /* éš±è— input çš„ä¸Šä¸‹ç®­é ­ */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .fraction-line { width: 60px; height: 3px; background-color: #333; margin: 5px 0; border-radius: 2px; }
        .denom-display { font-size: 2rem; font-weight: bold; color: #333; }

        .btn { padding: 12px 35px; font-size: 1.3rem; background-color: #4CAF50; color: white; border: none; border-radius: 50px; cursor: pointer; transition: all 0.2s; margin: 10px; box-shadow: 0 4px #2E7D32; }
        .btn:hover { background-color: #45a049; transform: translateY(-2px); box-shadow: 0 6px #2E7D32; }
        .btn:active { transform: translateY(2px); box-shadow: 0 1px #2E7D32; }
        .btn-new { background-color: #2196F3; display: none; box-shadow: 0 4px #1565C0; }
        .btn-new:hover { background-color: #1E88E5; box-shadow: 0 6px #1565C0; }
        
        #message { margin-top: 25px; font-size: 1.6rem; font-weight: bold; min-height: 50px; padding: 10px; border-radius: 10px; }
        .correct { color: #2e7d32; background: #C8E6C9; }
        .wrong { color: #c62828; background: #FFCDD2; }
        /* --- æ¨£å¼è¨­å®šçµæŸ --- */
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ• æŠ«è–©åˆ‡åˆ‡æ¨‚ V2ï¼šçœ‹åœ–å­¸åˆ†æ•¸</h1>
    <div class="score-board">
        ğŸ”¥ é€£çºŒç­”å°ï¼š<span id="streak" style="color: #FF5722; font-weight:bold;">0</span> é¡Œ | 
        ğŸ† ç¸½åˆ†ï¼š<span id="score" style="color: #2196F3; font-weight:bold;">0</span>
    </div>

    <div class="game-area">
        <div class="fraction-box">
            <div class="visual-container">
                <div id="pie1-fill" class="pie-fill"></div>
                <svg id="pie1-lines" class="slice-outlines" viewBox="0 0 140 140"></svg>
            </div>
            <div class="fraction-text" id="frac1"></div>
        </div>

        <div class="operator" id="operator">+</div>

        <div class="fraction-box">
            <div class="visual-container">
                <div id="pie2-fill" class="pie-fill"></div>
                <svg id="pie2-lines" class="slice-outlines" viewBox="0 0 140 140"></svg>
            </div>
            <div class="fraction-text" id="frac2"></div>
        </div>

        <div class="operator">=</div>

        <div class="fraction-box">
            <div class="visual-container" style="opacity: 0.6;">
                <div id="pieAnswer-fill" class="pie-fill" style="background: transparent; border-color: #888; border-style: dashed;"></div>
                <svg id="pieAnswer-lines" class="slice-outlines" viewBox="0 0 140 140"></svg>
            </div>
            <div class="input-group">
                <input type="number" id="ansNum" placeholder="?">
                <div class="fraction-line"></div>
                <span class="denom-display" id="ansDenom">8</span>
            </div>
        </div>
    </div>

    <div class="answer-section">
        <button class="btn" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
        <button class="btn btn-new" id="nextBtn" onclick="initGame()">æŒ‘æˆ°ä¸‹ä¸€é¡Œï¼</button>
        <div id="message"></div>
    </div>
</div>

<script>
    let currentNum1, currentNum2, currentDenom, isAddition;
    let score = 0;
    let streak = 0;

    // ç¹ªè£½æŠ«è–©çš„å‡½æ•¸ (æ ¸å¿ƒæ”¹é€²éƒ¨åˆ†)
    function drawPie(fillId, linesId, num, denom, color) {
        // 1. è™•ç†é¡è‰²å¡«å…… (ä½¿ç”¨ CSS conic-gradient)
        const percent = (num / denom) * 100;
        const fillElement = document.getElementById(fillId);
        // å¦‚æœæ˜¯ç­”æ¡ˆå€ä¸”å°šæœªä½œç­”(numç‚º0)ï¼Œä¿æŒé€æ˜ï¼›å¦å‰‡å¡«è‰²
        if (num === 0 && fillId === 'pieAnswer-fill') {
             fillElement.style.background = 'transparent';
        } else {
             fillElement.style.background = `conic-gradient(${color} 0% ${percent}%, white ${percent}% 100%)`;
        }
       

        // 2. è™•ç†åˆ‡ç·š (ä½¿ç”¨ SVG)
        const svgElement = document.getElementById(linesId);
        svgElement.innerHTML = ''; // æ¸…ç©ºèˆŠçš„ç·š

        const centerX = 70;
        const centerY = 70;
        const radius = 70;
        const angleStep = 360 / denom;

        for (let i = 0; i < denom; i++) {
            const angle = i * angleStep;
            // è¨ˆç®—ç·šæ¢çµ‚é»åº§æ¨™ (æ•¸å­¸éƒ¨åˆ†ï¼šå°‡è§’åº¦è½‰æ›ç‚ºå¼§åº¦ä¸¦è¨ˆç®—åº§æ¨™)
            const radian = (angle - 90) * (Math.PI / 180); // -90 æ˜¯ç‚ºäº†å¾æ­£ä¸Šæ–¹é–‹å§‹
            const endX = centerX + radius * Math.cos(radian);
            const endY = centerY + radius * Math.sin(radian);

            // å‰µå»º SVG ç·šæ¢å…ƒç´ 
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", centerX);
            line.setAttribute("y1", centerY);
            line.setAttribute("x2", endX);
            line.setAttribute("y2", endY);
            line.setAttribute("class", "slice-line");
            svgElement.appendChild(line);
        }
    }

    function initGame() {
        // é‡ç½®ä»‹é¢
        document.getElementById('message').innerHTML = "";
        document.getElementById('message').className = "";
        document.getElementById('ansNum').value = "";
        document.getElementById('nextBtn').style.display = "none";
        document.getElementById('ansNum').focus(); // å°‡æ¸¸æ¨™ç§»åˆ°è¼¸å…¥æ¡†

        // éš¨æ©Ÿç”Ÿæˆåˆ†æ¯ (4, 5, 6, 8, 9, 10, 12) - ç¨å¾®å¢åŠ ä¸€é»è®ŠåŒ–
        const denoms = [4, 5, 6, 8, 9, 10, 12];
        currentDenom = denoms[Math.floor(Math.random() * denoms.length)];
        
        // æ›´æ–°ç­”æ¡ˆå€çš„åˆ†æ¯é¡¯ç¤º
        document.getElementById('ansDenom').innerText = currentDenom;

        // æ±ºå®šåŠ æ³•æˆ–æ¸›æ³•
        isAddition = Math.random() > 0.5;
        document.getElementById('operator').innerText = isAddition ? "+" : "-";

        // ç”Ÿæˆåˆ†å­
        if (isAddition) {
            // åŠ æ³•ï¼šç¢ºä¿å’Œä¸è¶…é 1 (çœŸåˆ†æ•¸)
            currentNum1 = Math.floor(Math.random() * (currentDenom - 2)) + 1;
            let maxNum2 = currentDenom - currentNum1;
            currentNum2 = Math.floor(Math.random() * maxNum2) + 1;
        } else {
            // æ¸›æ³•ï¼šç¢ºä¿ç¬¬ä¸€å€‹æ•¸å¤§æ–¼ç¬¬äºŒå€‹æ•¸
            currentNum1 = Math.floor(Math.random() * (currentDenom - 2)) + 2; // è‡³å°‘æ˜¯ 2/N
            currentNum2 = Math.floor(Math.random() * (currentNum1 - 1)) + 1;
        }

        // æ›´æ–°æ–‡å­—é¡¯ç¤º (ä½¿ç”¨ sup å’Œ sub æ¨™ç±¤è®“åˆ†æ•¸æ›´æ¼‚äº®)
        document.getElementById('frac1').innerHTML = `<sup>${currentNum1}</sup>&frasl;<sub>${currentDenom}</sub>`;
        document.getElementById('frac2').innerHTML = `<sup>${currentNum2}</sup>&frasl;<sub>${currentDenom}</sub>`;

        // ç¹ªè£½é¡Œç›®åœ–å½¢
        drawPie('pie1-fill', 'pie1-lines', currentNum1, currentDenom, '#FF7043'); // æ©˜ç´…è‰²
        drawPie('pie2-fill', 'pie2-lines', currentNum2, currentDenom, '#42A5F5'); // è—è‰²
        // ç¹ªè£½ç­”æ¡ˆå€çš„ç©ºåˆ‡ç·šåœ– (åˆ†å­å‚³ 0ï¼Œåªç•«ç·šä¸å¡«è‰²)
        drawPie('pieAnswer-fill', 'pieAnswer-lines', 0, currentDenom, 'transparent');
    }

    function checkAnswer() {
        const userAnsInput = document.getElementById('ansNum');
        const userAns = parseInt(userAnsInput.value);
        
        // ç°¡å–®çš„é˜²å‘†ï¼šæ²’è¼¸å…¥æ•¸å­—å°±é€å‡º
        if (isNaN(userAns)) {
             document.getElementById('message').innerText = "ğŸ¤” è¨˜å¾—å¡«å¯«ç­”æ¡ˆå–”ï¼";
             document.getElementById('message').className = "";
             userAnsInput.focus();
             return;
        }

        let correctAns;
        if (isAddition) {
            correctAns = currentNum1 + currentNum2;
        } else {
            correctAns = currentNum1 - currentNum2;
        }

        const msgDiv = document.getElementById('message');
        
        if (userAns === correctAns) {
            score += 10;
            streak++;
            msgDiv.innerHTML = `ğŸ‰ ç­”å°äº†ï¼å¤ªæ£’äº†ï¼<br> ${currentNum1} ç‰‡ + ${currentNum2} ç‰‡ = ${correctAns} ç‰‡ï¼`;
            msgDiv.className = "correct";
            // é¡¯ç¤ºæ­£ç¢ºåœ–å½¢ (ç¶ è‰²)
            drawPie('pieAnswer-fill', 'pieAnswer-lines', correctAns, currentDenom, '#66BB6A');
            document.getElementById('nextBtn').style.display = "inline-block";
            document.getElementById('nextBtn').focus(); // å°‡ç„¦é»ç§»åˆ°ä¸‹ä¸€é¡ŒæŒ‰éˆ•
        } else {
            streak = 0;
            msgDiv.innerHTML = `ğŸ˜… å“å‘€ï¼Œå†è©¦è©¦çœ‹ï¼<br>çœ‹çœ‹åœ–ï¼Œåˆ†æ¯(åˆ‡æˆå¹¾ä»½)æ˜¯ä¸è®Šçš„ï¼Œåªè¦çœ‹åˆ†å­(å¡—è‰²å¹¾ä»½)å°±å¥½å›‰ï¼`;
            msgDiv.className = "wrong";
            userAnsInput.select(); // é¸å–éŒ¯èª¤ç­”æ¡ˆæ–¹ä¾¿é‡è¼¸
        }

        // æ›´æ–°åˆ†æ•¸æ¿
        document.getElementById('score').innerText = score;
        document.getElementById('streak').innerText = streak;
    }

    // ç›£è½ Enter éµï¼Œæ–¹ä¾¿æ“ä½œ
    document.getElementById('ansNum').addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        checkAnswer();
      }
    });

    // åˆå§‹åŒ–éŠæˆ²
    initGame();
</script>

</body>
</html>